@model IEnumerable<kursa4.Models.Laptop>

@{
    ViewData["Title"] = "Ноутбуки";
}

<h2 class="mb-4">Список ноутбуков</h2>

<button type="button" class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#addLaptopModal">
    Добавить ноутбук
</button>

<div class="table-responsive">
    <table class="table table-bordered table-striped align-middle table-sm">
        <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>Название</th>
            <th>Категория</th>
            <th>CPU / GPU</th>
            <th>ОЗУ / Память</th>
            <th>Экран</th>
            <th>Частота / Батарея</th>
            <th>Размер / Вес</th>
            <th>OS</th>
            <th>Цена</th>
            <th>В наличии</th>
            <th>Год</th>
            <th></th>
        </tr>
        </thead>
        <tbody>
        @foreach (var laptop in Model)
        {
            <tr>
                <td>@laptop.Id</td>
                <td>@($"{laptop.Brand?.Name} {laptop.Model}")</td>
                <td>@laptop.Category?.Name</td>
                <td>
                    @laptop.CPU?.Name<br />
                    @laptop.GPU?.Name
                </td>
                <td>@($"{laptop.RAM?.SizeGb} ГБ / {laptop.Storage?.SizeGb} ГБ")</td>
                <td>@($"{laptop.ScreenSize}\" / {laptop.Resolution}")</td>
                <td>@($"{laptop.RefreshRate} Гц / {laptop.BatteryWh} Втч")</td>
                <td>@($"{laptop.Width}×{laptop.Height}×{laptop.Depth} мм / {laptop.Weight} г")</td>
                <td>@laptop.OS</td>
                <td>@($"{laptop.Price:C}")</td>
                <td>@laptop.StockQuantity</td>
                <td>@laptop.ReleaseYear</td>
                <td>
                    <a asp-action="Edit" asp-route-id="@laptop.Id" class="btn btn-sm btn-warning">Изменить</a>
                    <button type="button" class="btn btn-sm btn-danger" data-bs-toggle="modal"
                            data-bs-target="#confirmDeleteModal" data-laptop-id="@laptop.Id"
                            data-laptop-name="@($"{laptop.Brand?.Name}  {laptop.Model}")">
                        Удалить
                    </button>
                </td>
            </tr>
        }
        </tbody>
    </table>

    <!-- Модалка подтверждения удаления -->
    <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form id="deleteForm" asp-controller="Admin" asp-action="DeleteLaptop" method="post">
                    @Html.AntiForgeryToken()
                    <div class="modal-header">
                        <h5 class="modal-title" id="confirmDeleteModalLabel">Подтвердите удаление</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрыть"></button>
                    </div>
                    <div class="modal-body">
                        Вы уверены, что хотите удалить <strong id="deleteLaptopName"></strong>?
                        <input type="hidden" name="id" id="deleteLaptopId" />
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                        <button type="submit" class="btn btn-danger">Удалить</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Модальное окно добавления -->
    <div class="modal fade" id="addLaptopModal" tabindex="-1" aria-labelledby="addLaptopModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <form asp-action="AddLaptop" asp-controller="Admin" method="post" enctype="multipart/form-data">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addLaptopModalLabel">Добавить ноутбук</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрыть"></button>
                    </div>
                    <div class="modal-body" style="max-height: calc(100vh - 200px); overflow-y: auto;">
                        @Html.AntiForgeryToken()

                        <div class="mb-3">
                            <label class="form-label">Модель</label>
                            <input type="text" name="Model" class="form-control" required />
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Категория</label>
                            <select name="CategoryId" class="form-select" required>
                                <option value="">Выберите категорию</option>
                                @foreach (var category in ViewBag.Categories)
                                {
                                    <option value="@category.Id">@category.Name</option>
                                }
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Бренд</label>
                            <select name="BrandId" class="form-select" required>
                                <option value="">Выберите бренд</option>
                                @foreach (var brand in ViewBag.Brands)
                                {
                                    <option value="@brand.Id">@brand.Name</option>
                                }
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">ЦПУ</label>
                            <select name="CPUId" class="form-select" required>
                                <option value="">Выберите ЦПУ</option>
                                @foreach (var cpu in ViewBag.CPUs)
                                {
                                    <option value="@cpu.Id">@cpu.Name</option>
                                }
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">ГПУ</label>
                            <select name="GPUId" class="form-select" required>
                                <option value="">Выберите ГПУ</option>
                                @foreach (var gpu in ViewBag.GPUs)
                                {
                                    <option value="@gpu.Id">@gpu.Name</option>
                                }
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">ОЗУ</label>
                            <select name="RAMId" class="form-select" required>
                                <option value="">Выберите ОЗУ</option>
                                @foreach (var ram in ViewBag.RAMs)
                                {
                                    <option value="@ram.Id">@($"{ram.Type} - {ram.SizeGb} ГБ")</option>
                                }
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Память</label>
                            <select name="StorageId" class="form-select" required>
                                <option value="">Выберите память</option>
                                @foreach (var storage in ViewBag.Storages)
                                {
                                    <option value="@storage.Id">@($"{storage.Type} - {storage.SizeGb} ГБ")</option>
                                }
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Операционная система</label>
                            <input type="text" name="OS" class="form-control" required />
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Цена</label>
                            <input type="text" name="Price" class="form-control" required />
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Год выпуска</label>
                            <input type="number" name="ReleaseYear" class="form-control" required />
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Объём батареи (Вт⋅ч)</label>
                            <input type="number" name="BatteryWh" class="form-control" step="1" required />
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Размер экрана (дюймы)</label>
                            <input type="number" name="ScreenSize" class="form-control" step="0.1" required />
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Частота обновления (Гц)</label>
                            <input type="number" name="RefreshRate" class="form-control" required />
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Разрешение экрана</label>
                            <input type="text" name="Resolution" class="form-control" required />
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Вес (г)</label>
                            <input type="number" name="Weight" class="form-control" step="0.01" required />
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Размеры (Ш × В × Г, мм)</label>
                            <div class="row g-2">
                                <div class="col">
                                    <input type="number" name="Width" class="form-control" placeholder="Ширина" step="0.1" required />
                                </div>
                                <div class="col">
                                    <input type="number" name="Height" class="form-control" placeholder="Высота" step="0.1" required />
                                </div>
                                <div class="col">
                                    <input type="number" name="Depth" class="form-control" placeholder="Глубина" step="0.1" required />
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Изображение</label>
                            <input type="file" name="ImageFile" class="form-control" accept="image/*" required />
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Количество в наличии</label>
                            <input type="number" name="StockQuantity" class="form-control" required />
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Описание</label>
                            <textarea name="Description" class="form-control" rows="3"></textarea>
                        </div>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                        <button type="submit" class="btn btn-success">Добавить</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        var deleteModal = document.getElementById('confirmDeleteModal');
        deleteModal.addEventListener('show.bs.modal', function (event) {
            var button = event.relatedTarget;
            var laptopId = button.getAttribute('data-laptop-id');
            var laptopName = button.getAttribute('data-laptop-name');

            var modalTitle = deleteModal.querySelector('#deleteLaptopName');
            var modalInput = deleteModal.querySelector('#deleteLaptopId');

            modalTitle.textContent = laptopName;
            modalInput.value = laptopId;
        });
    </script>
</div>
