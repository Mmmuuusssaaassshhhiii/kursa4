@model kursa4.Models.User
@{
    ViewBag.Title = "Регистрация";
}

<form asp-action="Register" method="post" class="w-100 m-auto" style="max-width: 400px;">
    <h1 class="h3 mb-3 fw-normal">Регистрация</h1>

    <div class="form-floating mb-2">
        <input asp-for="FullName" class="form-control" placeholder="Имя Фамилия" required />
        <label asp-for="FullName">Имя пользователя</label>
        <span asp-validation-for="FullName" class="text-danger"></span>
    </div>

    <div class="form-floating mb-2">
        <input asp-for="Email" class="form-control" placeholder="email@example.com" required />
        <label asp-for="Email">Email</label>
        <span asp-validation-for="Email" class="text-danger"></span>
    </div>

    <div class="form-floating mb-2">
        <input asp-for="PhoneNumber"
               class="form-control"
               id="phoneInput"
               placeholder="+375(XX)XXX-XX-XX"
               pattern="^\+375\(\d{2}\)\d{3}-\d{2}-\d{2}$"
               title="Введите номер в формате: +375(29)123-45-67"
               required />
        <label asp-for="PhoneNumber">Номер телефона</label>
        <span asp-validation-for="PhoneNumber" class="text-danger"></span>
    </div>

    <div class="form-floating mb-2">
        <input asp-for="Password" class="form-control" type="password" placeholder="Пароль" required />
        <label asp-for="Password">Пароль</label>
        <span asp-validation-for="Password" class="text-danger"></span>
    </div>

    <div class="form-floating mb-3">
        <input type="password" name="ConfirmPassword" class="form-control" placeholder="Подтвердите пароль" required />
        <label for="ConfirmPassword">Подтвердите пароль</label>
    </div>

    @if (!ViewData.ModelState.IsValid)
    {
        <div class="alert alert-danger">Пожалуйста, исправьте ошибки в форме.</div>
    }

    <button class="btn btn-primary w-100 py-2" type="submit">Зарегистрироваться</button>
</form>

<script>
    const phoneInput = document.getElementById('phoneInput');

    phoneInput.addEventListener('input', function (e) {
        let input = phoneInput.value.replace(/\D/g, ''); // убираем все нецифры

        if (input.startsWith('375')) {
            input = input.slice(3); // удалим первую 375, т.к. она будет в шаблоне
        }

        // Обрезаем до нужной длины
        input = input.substring(0, 9); // XX XXX XX XX → 9 цифр после 375

        let formatted = '+375';

        if (input.length > 0) {
            formatted += '(' + input.substring(0, 2);
        }
        if (input.length >= 2) {
            formatted += ')';
        }
        if (input.length >= 5) {
            formatted += input.substring(2, 5) + '-' + input.substring(5, 7);
        } else if (input.length > 2) {
            formatted += input.substring(2);
        }
        if (input.length >= 7) {
            formatted += '-' + input.substring(7, 9);
        }

        phoneInput.value = formatted;
    });

    phoneInput.addEventListener('keypress', function (e) {
        // блокируем всё, кроме цифр
        if (!/[0-9]/.test(e.key)) {
            e.preventDefault();
        }
    });
</script>
